{% extends "base.html" %}
{% set active="admin" %}

{% block title %}Certificado especial · Admin · Cabildo Indígena de la Peñata{% endblock %}

{% block content %}
<section class="hero">
  <div class="container">
    <h2>Certificado especial (Admin)</h2>
    <p>Cree un certificado con mensaje personalizado para reconocer la labor o participación de una persona en el Cabildo. El sistema valida el documento en el censo antes de generarlo.</p>
  </div>
</section>

<div class="cards-stack">
  <div class="card" id="adminSpecialCard" data-min-transition="{{ ui_min_transition_seconds|default(2) }}">

    <!-- Paso 1: Documento -->
    <div id="adminSpecialStepDoc">
      <form id="adminSpecialDocForm" novalidate>
        <div class="form-group">
          <label for="adminSpecialDocNumber">Número de Documento</label>
          <input id="adminSpecialDocNumber" type="tel" inputmode="numeric" placeholder="Ingrese el número" required>
        </div>

        <div id="adminSpecialFormError" style="display:none; background:#ffebee; color:#b71c1c; padding:12px; border-radius:12px; margin-bottom: 14px; text-align:center;">
          <strong style="display:block; margin-bottom:4px;">Atención</strong>
          <span id="adminSpecialFormErrorText"></span>
        </div>

        <button type="submit" class="btn-submit">CONTINUAR</button>

        <div style="margin-top: 14px; text-align:center;">
          <a href="{{ url_for('admin_panel') }}" class="btn-secondary" style="width:auto; min-width: 200px; text-decoration:none; display:inline-flex; align-items:center; justify-content:center;">
            Volver al panel
          </a>
        </div>
      </form>
    </div>

    <!-- Paso 2: Texto personalizado -->
    <div id="adminSpecialStepText" style="display:none;">
      <form id="adminSpecialTextForm" novalidate>
        <div style="background:#f5f7fa; border:1px solid #e5ebf2; padding:12px; border-radius:14px; margin-bottom: 14px;">
          <p style="margin:0; font-weight: 700;" id="adminSpecialResNombre"></p>
          <p style="margin:4px 0 0 0; color:#666; font-size: 0.92rem;" id="adminSpecialResDoc" class="doc-mask"></p>
        </div>

        <div style="background:#fff8e1; border:1px solid rgba(212,175,55,0.35); padding:12px; border-radius:14px; margin-bottom: 14px; color:#7a5b00; text-align:center;">
          <strong style="display:block;">Tenga en cuenta la ortografía</strong>
          <span style="font-size:0.92rem;">El texto se agregará después de la frase de identificación.</span>
        </div>

        <div class="form-group">
          <label for="adminSpecialTexto">Texto personalizado</label>
          <textarea id="adminSpecialTexto" rows="6" placeholder="Escriba el texto que desea agregar" required style="resize: vertical;"></textarea>
          <div style="margin-top:8px; color:#667085; font-size:0.88rem;">
            Se generará como: <span style="font-weight:600;" id="adminSpecialIntroPreview"></span>
          </div>
        </div>

        <div id="adminSpecialTextError" style="display:none; background:#ffebee; color:#b71c1c; padding:12px; border-radius:12px; margin-bottom: 14px; text-align:center;">
          <strong style="display:block; margin-bottom:4px;">Atención</strong>
          <span id="adminSpecialTextErrorText"></span>
        </div>

        <button type="submit" class="btn-submit">
          <i data-lucide="arrow-right" aria-hidden="true"></i>
          <span>Continuar</span>
        </button>

        <div style="margin-top: 12px; display:flex; gap:10px; flex-wrap: wrap; justify-content:center;">
          <button id="adminSpecialBtnCambiarDoc" type="button" class="btn-secondary" style="width:auto; min-width: 200px;">Cambiar documento</button>
          <a href="{{ url_for('admin_panel') }}" class="btn-secondary" style="width:auto; min-width: 200px; text-decoration:none; display:inline-flex; align-items:center; justify-content:center;">
            Volver al panel
          </a>
        </div>
      </form>
    </div>

    <!-- Paso 3: Confirmación (previo a generar) -->
    <div id="adminSpecialStepConfirm" style="display:none;">
      <div style="background:#f5f7fa; border:1px solid #e5ebf2; padding:12px; border-radius:14px; margin-bottom: 14px;">
        <p style="margin:0; font-weight: 700;" id="adminSpecialConfirmNombre"></p>
        <p style="margin:4px 0 0 0; color:#666; font-size: 0.92rem;" id="adminSpecialConfirmDoc" class="doc-mask"></p>
      </div>

      <div style="background:#fff; border:1px solid #e6ebf1; padding:14px; border-radius:14px; margin-bottom: 14px;">
        <div style="font-weight:700; margin-bottom:6px;">Revise su información antes de continuar</div>
        <div style="color:#667085; font-size:0.92rem; margin-bottom: 10px;">Texto que se agregará al certificado:</div>
        <div style="background:#f7f9fc; border:1px dashed #d8e2ee; border-radius:12px; padding:12px; white-space:pre-wrap;" id="adminSpecialConfirmTexto"></div>
      </div>

      <div style="display:flex; gap:10px; flex-wrap: wrap; justify-content:center;">
        <button id="adminSpecialBtnAtras" type="button" class="btn-secondary" style="width:auto; min-width: 200px;">
          <i data-lucide="arrow-left" aria-hidden="true"></i>
          <span>Atrás</span>
        </button>
        <button id="adminSpecialBtnGenerarFinal" type="button" class="btn-submit" style="width:auto; min-width: 200px;">
          <i data-lucide="file-plus" aria-hidden="true"></i>
          <span>Generar certificado</span>
        </button>
      </div>

      <div style="margin-top: 12px; display:flex; gap:10px; flex-wrap: wrap; justify-content:center;">
        <button id="adminSpecialBtnCambiarDoc2" type="button" class="btn-secondary" style="width:auto; min-width: 200px;">Cambiar documento</button>
        <a href="{{ url_for('admin_panel') }}" class="btn-secondary" style="width:auto; min-width: 200px; text-decoration:none;">
          <i data-lucide="layout-dashboard" aria-hidden="true"></i>
          <span>Volver al panel</span>
        </a>
      </div>
    </div>

    <!-- Paso: Loading -->
    <div id="adminSpecialStepLoading" style="display:none; text-align:center; padding: 8px 0;">
      <div class="inline-loader">
        <div class="inline-loader__spinner"></div>
        <h3 id="adminSpecialLoadingTitle" style="margin: 16px 0 6px 0;">Procesando...</h3>
        <p id="adminSpecialLoadingSubtitle" style="margin:0; color:#666; font-size: 0.95rem;">Por favor espere</p>
      </div>
    </div>

    <!-- Paso: Ready -->
    <div id="adminSpecialStepReady" style="display:none; text-align: center; padding: 10px 0;">
      <div style="background: #e8f5e9; color: #2e7d32; padding: 15px; border-radius: 12px; margin-bottom: 14px;">
        <h3 style="margin:0;">Certificado especial listo</h3>
        <p style="margin:6px 0 0 0; font-size: 0.9rem;">Puede descargarlo o verlo en línea.</p>
      </div>

      <p style="margin-bottom: 5px; font-weight: bold;" id="adminSpecialReadyNombre"></p>
      <p style="color: #666; font-size: 0.9rem;" id="adminSpecialReadyDoc" class="doc-mask"></p>
      <p style="color: #666; font-size: 0.85rem; margin-top: 6px;">Código de verificación: <span id="adminSpecialReadyCodigo" style="font-family: monospace;"></span></p>

      <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

      <div style="display:flex; gap:10px; justify-content:center; flex-wrap: wrap;">
        <a id="adminSpecialBtnDescargar" href="#" class="btn-submit" style="text-decoration: none; display: inline-block; background: #2e7d32; width:auto; padding: 12px 16px;">
          DESCARGAR
        </a>

        <a id="adminSpecialBtnVerCertificado" href="#" target="_blank" rel="noopener" class="btn-submit" style="text-decoration: none; display: inline-block; background: #1565c0; width:auto; padding: 12px 16px;">
          VER CERTIFICADO
        </a>
      </div>

      <p style="margin-top: 14px; color:#666; font-size:0.85rem;">
        Verificación pública: <br>
        <a id="adminSpecialVerifyLink" href="#" target="_blank" style="word-break: break-all; color: var(--primary); text-decoration: underline;"></a>
      </p>

      <div style="margin-top: 12px; display:flex; gap:10px; flex-wrap: wrap; justify-content:center;">
        <button id="adminSpecialBtnOtra" type="button" class="btn-secondary" style="width:auto; min-width: 200px;">Generar otro</button>
        <a href="{{ url_for('admin_panel') }}" class="btn-secondary" style="width:auto; min-width: 200px; text-decoration:none; display:inline-flex; align-items:center; justify-content:center;">
          Volver al panel
        </a>
      </div>

      <p style="margin-top: 12px; color:#777; font-size:0.82rem;">
        Cada certificado especial genera un código nuevo para el sistema de verificación.
      </p>
    </div>

    <!-- Error -->
    <div id="adminSpecialStepError" style="display:none; text-align: center; padding: 10px 0;">
      <div style="background: #ffebee; color: #b71c1c; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
        <h3 style="margin:0;">No fue posible continuar</h3>
        <p style="margin:6px 0 0 0; font-size: 0.9rem;" id="adminSpecialErrorText"></p>
      </div>

      <div style="display:flex; gap:10px; flex-wrap: wrap; justify-content:center;">
        <button id="adminSpecialBtnReintentar" type="button" class="btn-submit" style="background: var(--primary); width:auto; min-width: 200px;">Intentar de nuevo</button>
        <a href="{{ url_for('admin_panel') }}" class="btn-secondary" style="width:auto; min-width: 200px; text-decoration:none; display:inline-flex; align-items:center; justify-content:center;">Volver al panel</a>
      </div>
    </div>

  </div>
</div>

{% endblock %}
