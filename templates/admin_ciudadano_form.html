{% extends "base.html" %}
{% set active="admin" %}

{% block title %}{% if mode=='editar' %}Editar ciudadano{% else %}Nuevo ciudadano{% endif %} · Panel Admin{% endblock %}

{% block content %}
<section class="hero">
  <div class="container">
    <h2>{% if mode=='editar' %}Editar ciudadano{% else %}Agregar ciudadano{% endif %}</h2>
    <p>Gestione los datos del ciudadano y el estado de afiliación.</p>
  </div>
</section>

<div class="cards-stack">
  <div class="card" id="adminCitizenFormCard">
    <div class="fade-in">

      {% if flash %}
      <div class="alert alert--{{ flash.kind|default('info') }}" role="status" style="display:none;"
        data-flash-kind="{{ flash.kind|default('info') }}" data-flash-text="{{ flash.text|e }}">
        {{ flash.text }}
      </div>
      {% endif %}

      {% if error %}
      <div class="alert alert--error" role="alert">
        <strong>Revise la información:</strong> {{ error }}
      </div>
      {% endif %}

      <form method="post" action="{% if mode=='editar' %}{{ url_for('admin_ciudadanos_editar_post', cid=ciudadano.id) }}{% else %}{{ url_for('admin_ciudadanos_nuevo_post') }}{% endif %}" class="admin-form" novalidate>
        {% if csrf_token is defined %}
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% endif %}

        <div class="admin-form__grid">
          <div class="form-group">
            <label for="nombre">Nombre completo</label>
            <input id="nombre" name="nombre" type="text" placeholder="Ej: Juan Pérez García" required value="{{ values.nombre|default('') }}">
          </div>

          <div class="form-group">
            <label for="tipo">Tipo de documento</label>
            <select id="tipo" name="tipo" required>
              {% set current_tipo = (values.tipo|default('CC')) %}
              <option value="CC" {% if current_tipo=='CC' %}selected{% endif %}>CC</option>
              <option value="TI" {% if current_tipo=='TI' %}selected{% endif %}>TI</option>
              <option value="RC" {% if current_tipo=='RC' %}selected{% endif %}>RC</option>
            </select>
          </div>

          <div class="form-group">
            <label for="numero">Número de documento</label>
            <input id="numero" name="numero" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Solo números" required value="{{ values.numero|default('') }}">
            <p class="field-hint">Evite puntos, espacios o guiones.</p>
          </div>

          <div class="form-group">
            <label for="nacimiento">Fecha de nacimiento</label>
            <input id="nacimiento" name="nacimiento" type="date" class="input-date" required value="{{ values.nacimiento|default('') }}">
            <p class="field-hint">Se solicitará al ciudadano para validar su titularidad y para control general.</p>
          </div>
        </div>

        <div class="admin-switch">
          <label class="switch">
            <input type="checkbox" name="activo" {% if values.activo|default(true) %}checked{% endif %}>
            <span class="switch__slider" aria-hidden="true"></span>
          </label>
          <div class="switch__text">
            <div class="switch__title">Afiliación activa</div>
            <div class="switch__desc">Si está desactivada, el ciudadano no podrá generar certificados en el portal público.</div>
          </div>
        </div>

        <div class="admin-form__actions">
          <button type="submit" class="btn-submit">
            <i data-lucide="save" aria-hidden="true"></i>
            <span>Guardar</span>
          </button>
          <a href="{{ url_for('admin_ciudadanos') }}" class="btn-secondary" style="text-decoration:none;">
            <i data-lucide="x" aria-hidden="true"></i>
            <span>Cancelar</span>
          </a>
        </div>
      </form>

      {% if mode=='editar' and ciudadano %}
      <div class="admin-mini-card">
        <div class="muted tiny">ID interno</div>
        <div class="cell-title">{{ ciudadano.id }}</div>
        <div class="muted tiny" style="margin-top:10px;">Public ID</div>
        <div class="cell-title" style="word-break:break-all;">{{ ciudadano.public_id }}</div>
      </div>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}
