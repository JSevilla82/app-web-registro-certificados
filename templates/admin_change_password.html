{% extends "base.html" %}
{% set active="admin" %}

{% block title %}Cambiar contrasena Â· Admin{% endblock %}

{% block content %}
<section class="hero">
  <div class="container">
    <h2>Admin</h2>
    <p>Cambio de contrasena obligatorio.</p>
  </div>
</section>

<div class="cards-stack">
  <div class="card" id="adminChangeCard" data-min-transition="{{ ui_min_transition_seconds|default(2) }}">

    <!-- Paso 1: Formulario -->
    <div id="adminChangeStepForm">
      <div style="background:#e3f2fd; color:#0f3a5f; padding:12px; border-radius:12px; margin-bottom: 14px; text-align:center;">
        <strong style="display:block; margin-bottom:6px;">Debe cambiar su contrasena temporal</strong>
        <span style="display:block; line-height:1.35;">
          Por seguridad, antes de entrar al panel debe establecer una contrasena nueva.
          {% if admin_username %}<br><span style="color:#08304f;">Usuario: <strong>{{ admin_username }}</strong></span>{% endif %}
        </span>
      </div>

      <form id="adminChangePassForm" method="post" action="{{ url_for('admin_change_password_post') }}" novalidate>
        {% if csrf_token is defined %}
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% endif %}

        <div class="form-group">
          <label for="newPass">Nueva contrasena</label>
          <input id="newPass" name="new_password" type="password" autocomplete="new-password" placeholder="Ingrese una contrasena nueva" required>
        </div>

        <div class="form-group">
          <label for="confirmPass">Confirmar contrasena</label>
          <input id="confirmPass" name="confirm_password" type="password" autocomplete="new-password" placeholder="Repita la contrasena" required>
        </div>

        {% if error %}
        <div style="background:#ffebee; color:#b71c1c; padding:12px; border-radius:12px; margin-bottom: 14px; text-align:center;">
          <strong style="display:block; margin-bottom:6px;">No se pudo actualizar</strong>
          <span style="display:block; line-height:1.35;">{{ error }}</span>
        </div>
        {% endif %}

        <div id="adminChangeError" style="display:none; background:#ffebee; color:#b71c1c; padding:12px; border-radius:12px; margin-bottom: 14px; text-align:center;">
          <strong style="display:block; margin-bottom:6px;">Revise la informacion</strong>
          <span id="adminChangeErrorText">Debe ingresar y confirmar la contrasena.</span>
        </div>

        <button type="submit" class="btn-submit">GUARDAR CONTRASENA</button>
      </form>

      <p style="margin-top: 10px; color:#666; font-size:0.86rem; text-align:center;">
        Recomendacion: use al menos 8 caracteres e incluya letras y numeros.
      </p>

      <div style="margin-top: 14px; display:flex; justify-content:center;">
        <a href="{{ url_for('admin_logout') }}" class="btn-secondary" style="width:auto; min-width: 200px; text-decoration:none; display:inline-flex; align-items:center; justify-content:center;">
          Cancelar y cerrar sesion
        </a>
      </div>
    </div>

    <!-- Paso 2: Transicion -->
    <div id="adminChangeStepLoading" style="display:none; text-align:center; padding: 8px 0;">
      <div class="inline-loader">
        <div class="inline-loader__spinner"></div>
        <h3 style="margin: 16px 0 6px 0;">Guardando...</h3>
        <p style="margin:0; color:#666; font-size: 0.95rem;">Actualizando contrasena</p>
      </div>
    </div>

  </div>
</div>

{% endblock %}
